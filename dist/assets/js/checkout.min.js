jQuery(function($) {

    // check if billing or shipping address exists...
    if( $("#billing_city").length || $("#shipping_city").length ) {
        // detect when user selects city and get city postal codigo_departamento
        $(document).on("change", "#billing_city", function() {
            var billing_municipality_name = $("#billing_city").val();
            var billing_state_iso_code = $("#billing_state").val();
            if( $('.woocommerce-edit-address').length ) {
                billing_municipality_name = $("#billing_city option:selected").attr("data-code");
            }
            if( billing_municipality_name != "") {
                current_municipality = dl_wc_guatemala_checkout_js_vars.municipalities_array.find( $municipality => $municipality.codigo_iso_departamento == billing_state_iso_code && $municipality.nombre_municipio == billing_municipality_name );
                if( $('.woocommerce-edit-address').length ) {
                    current_municipality = dl_wc_guatemala_checkout_js_vars.municipalities_array.find( $municipality => $municipality.codigo_iso_departamento == billing_state_iso_code && $municipality.codigo_postal_municipio == billing_municipality_name );
                }
                // if only one city hide postal_code, if more than one show dropdown list
                if( current_municipality.ciudades.length == 1 ) {
                    select_html = `<input type="text" class="input-text " name="billing_postcode" id="billing_postcode" placeholder="" value="${current_municipality.ciudades[0].codigo_postal_ciudad}" style="display: none" readonly >`;
                    $('#billing_postcode_field .woocommerce-input-wrapper').html(select_html);
                    $('#billing_postcode_field').hide();
                } else if( current_municipality.ciudades.length > 1) {
                    select_html = `<select id="billing_postcode" name="billing_postcode" class="input-text" style="display: block;">
                        <option value="">` + dl_wc_guatemala_checkout_js_vars.i18n_select_postcode_text + `</option>
                    </select>`;
                    $('#billing_postcode_field .woocommerce-input-wrapper').html(select_html);
                    $('#billing_postcode_field').show();
                    $('#billing_postcode_field label').html( dl_wc_guatemala_checkout_js_vars.i18n_select_postcode_label + ' <abbr class="required" title="obligatorio">*</abbr>');
                    current_municipality.ciudades.forEach(function(ciudad) {
                        $("#billing_postcode").append("<option value='" + ciudad.codigo_postal_ciudad + "'>" + ciudad.nombre_ciudad + "</option>");
                    });
                }
            }
        });

        // detect when user selects city and get city postal codigo_departamento
        $(document).on("change", "#shipping_city", function() {
            var shipping_municipality_name = $("#shipping_city").val();
            var shipping_state_iso_code = $("#shipping_state").val();
            if( $('.woocommerce-edit-address').length ) {
                shipping_municipality_name = $("#shipping_city option:selected").attr("data-code");
            }
            if( shipping_municipality_name != "") {
                current_municipality = dl_wc_guatemala_checkout_js_vars.municipalities_array.find( $municipality => $municipality.codigo_iso_departamento == shipping_state_iso_code && $municipality.nombre_municipio == shipping_municipality_name );
                if( $('.woocommerce-edit-address').length ) {
                    current_municipality = dl_wc_guatemala_checkout_js_vars.municipalities_array.find( $municipality => $municipality.codigo_iso_departamento == shipping_state_iso_code && $municipality.codigo_postal_municipio == shipping_municipality_name );
                }
                // if only one city hide postal_code, if more than one show dropdown list
                if( current_municipality.ciudades.length == 1 ) {
                    select_html = `<input type="text" class="input-text " name="shipping_postcode" id="shipping_postcode" placeholder="" value="${current_municipality.ciudades[0].codigo_postal_ciudad}" style="display: none" readonly >`;
                    $('#shipping_postcode_field .woocommerce-input-wrapper').html(select_html);
                    $('#shipping_postcode_field').hide();
                } else if( current_municipality.ciudades.length > 1) {
                    select_html = `<select id="shipping_postcode" name="shipping_postcode" class="input-text" style="display: block;">
                        <option value="">` + dl_wc_guatemala_checkout_js_vars.i18n_select_postcode_text + `</option>
                    </select>`;
                    $('#shipping_postcode_field .woocommerce-input-wrapper').html(select_html);
                    $('#shipping_postcode_field').show();
                    $('#shipping_postcode_field label').html(dl_wc_guatemala_checkout_js_vars.i18n_select_postcode_label + ' <abbr class="required" title="obligatorio">*</abbr>');
                    current_municipality.ciudades.forEach(function(ciudad) {
                        $("#shipping_postcode").append("<option value='" + ciudad.codigo_postal_ciudad + "'>" + ciudad.nombre_ciudad + "</option>");
                    });
                }
            }
        });


        // en pÃ¡gins de mi cuenta, actualiuzar select options de municipios
        if( $('.woocommerce-edit-address').length ) {
            $('#billing_state').on('change', function() {
                var billing_state_postal_code = $("#billing_state").val();
                var billing_municipalities = dl_wc_guatemala_checkout_js_vars.municipalities_array.filter( $municipality => $municipality.codigo_iso_departamento == billing_state_postal_code );
                $('#billing_city').remove();
                select_html = `<select name="billing_city" id="billing_city" class="city_select " autocomplete="address-level2" placeholder="">
                <option value="">` + dl_wc_guatemala_checkout_js_vars.i18n_select_city_text + `</option>
                </select>`;
                $('#billing_city_field').append(select_html);
                billing_municipalities.forEach(function(municipality) {
                    $("#billing_city").append("<option data-code='" + municipality.codigo_postal_municipio + "' value='" + municipality.nombre_municipio + "'>" + municipality.nombre_municipio + "</option>");
                });

            });

            $('#shipping_state').on('change', function() {
                var shipping_state_postal_code = $("#shipping_state").val();
                var shipping_municipalities = dl_wc_guatemala_checkout_js_vars.municipalities_array.filter( $municipality => $municipality.codigo_iso_departamento == shipping_state_postal_code );
                $('#shipping_city').remove();
                select_html = `<select name="shipping_city" id="shipping_city" class="city_select " autocomplete="address-level2" placeholder="">
                <option value="">` + dl_wc_guatemala_checkout_js_vars.i18n_select_city_text + `</option>
                </select>`;
                $('#shipping_city_field').append(select_html);
                shipping_municipalities.forEach(function(municipality) {
                    $("#shipping_city").append("<option data-code='" + municipality.codigo_postal_municipio + "' value='" + municipality.nombre_municipio + "'>" + municipality.nombre_municipio + "</option>");
                });

            });
        }
    }

});


// after everything loads

jQuery(window).load(function(){
    if( jQuery('#billing_city').length ) {
            
        if( onlyNumbers( jQuery('#billing_city option:nth-of-type(2) ').val() ) ) {
            jQuery('#billing_city').find('option').each( function() {
                jQuery(this).attr("data-code", jQuery(this).val() );
                jQuery(this).val( jQuery(this).text() );
            });
        }

        if (typeof dl_wc_guatemala_billing_city !== 'undefined') {
            jQuery('#billing_city').find('option').each( function() {
                if( jQuery(this).text() == dl_wc_guatemala_billing_city ) {
                    jQuery(this).attr('selected', 'selected');
                    jQuery(this).prop('selected', true);
                    jQuery('#billing_city').trigger('change');
                    jQuery('#billing_postcode option[value="' + dl_wc_guatemala_billing_postcode + '"]').attr('selected', 'selected');
                    jQuery('#billing_postcode option[value="' + dl_wc_guatemala_billing_postcode + '"]').prop('selected', true);   
                    jQuery('#billing_postcode').trigger('change');
                    if( jQuery('#select2-billing_city-container').length > 0 ) {
                        jQuery('#select2-billing_city-container').html( dl_wc_guatemala_billing_city );
                    }
                }
            });
        }
    }

    

    if( jQuery('#shipping_city').length ) {

        if( onlyNumbers( jQuery('#shipping_city option:nth-of-type(2) ').val() ) ) {
            jQuery('#shipping_city').find('option').each( function() {
                jQuery(this).attr("data-code", jQuery(this).val() );
                jQuery(this).val( jQuery(this).text() );
            });
        }

        if (typeof dl_wc_guatemala_shipping_city !== 'undefined') {
            jQuery('#shipping_city').find('option').each( function() {
                if( jQuery(this).val() == dl_wc_guatemala_shipping_city ) {
                    jQuery(this).attr('selected', 'selected');
                    jQuery(this).prop('selected', true);
                    jQuery('#shipping_city').trigger('change');
                    jQuery('#shipping_postcode option[value="' + dl_wc_guatemala_shipping_postcode + '"]').attr('selected', 'selected');
                    jQuery('#shipping_postcode option[value="' + dl_wc_guatemala_shipping_postcode + '"]').prop('selected', true);   
                    jQuery('#shipping_postcode').trigger('change');
                    if( jQuery('#select2-shipping_city-container').length > 0 ) {
                        jQuery('#select2-shipping_city-container').html( dl_wc_guatemala_shipping_city );
                    }
                }
            });
        }
    }

    function onlyNumbers(str) {
        return /^\d+$/.test(str);
    }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNoZWNrb3V0LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImNoZWNrb3V0Lm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImpRdWVyeShmdW5jdGlvbigkKSB7XHJcblxyXG4gICAgLy8gY2hlY2sgaWYgYmlsbGluZyBvciBzaGlwcGluZyBhZGRyZXNzIGV4aXN0cy4uLlxyXG4gICAgaWYoICQoXCIjYmlsbGluZ19jaXR5XCIpLmxlbmd0aCB8fCAkKFwiI3NoaXBwaW5nX2NpdHlcIikubGVuZ3RoICkge1xyXG4gICAgICAgIC8vIGRldGVjdCB3aGVuIHVzZXIgc2VsZWN0cyBjaXR5IGFuZCBnZXQgY2l0eSBwb3N0YWwgY29kaWdvX2RlcGFydGFtZW50b1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIFwiI2JpbGxpbmdfY2l0eVwiLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgdmFyIGJpbGxpbmdfbXVuaWNpcGFsaXR5X25hbWUgPSAkKFwiI2JpbGxpbmdfY2l0eVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIGJpbGxpbmdfc3RhdGVfaXNvX2NvZGUgPSAkKFwiI2JpbGxpbmdfc3RhdGVcIikudmFsKCk7XHJcbiAgICAgICAgICAgIGlmKCAkKCcud29vY29tbWVyY2UtZWRpdC1hZGRyZXNzJykubGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgYmlsbGluZ19tdW5pY2lwYWxpdHlfbmFtZSA9ICQoXCIjYmlsbGluZ19jaXR5IG9wdGlvbjpzZWxlY3RlZFwiKS5hdHRyKFwiZGF0YS1jb2RlXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKCBiaWxsaW5nX211bmljaXBhbGl0eV9uYW1lICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnRfbXVuaWNpcGFsaXR5ID0gZGxfd2NfZ3VhdGVtYWxhX2NoZWNrb3V0X2pzX3ZhcnMubXVuaWNpcGFsaXRpZXNfYXJyYXkuZmluZCggJG11bmljaXBhbGl0eSA9PiAkbXVuaWNpcGFsaXR5LmNvZGlnb19pc29fZGVwYXJ0YW1lbnRvID09IGJpbGxpbmdfc3RhdGVfaXNvX2NvZGUgJiYgJG11bmljaXBhbGl0eS5ub21icmVfbXVuaWNpcGlvID09IGJpbGxpbmdfbXVuaWNpcGFsaXR5X25hbWUgKTtcclxuICAgICAgICAgICAgICAgIGlmKCAkKCcud29vY29tbWVyY2UtZWRpdC1hZGRyZXNzJykubGVuZ3RoICkge1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbXVuaWNpcGFsaXR5ID0gZGxfd2NfZ3VhdGVtYWxhX2NoZWNrb3V0X2pzX3ZhcnMubXVuaWNpcGFsaXRpZXNfYXJyYXkuZmluZCggJG11bmljaXBhbGl0eSA9PiAkbXVuaWNpcGFsaXR5LmNvZGlnb19pc29fZGVwYXJ0YW1lbnRvID09IGJpbGxpbmdfc3RhdGVfaXNvX2NvZGUgJiYgJG11bmljaXBhbGl0eS5jb2RpZ29fcG9zdGFsX211bmljaXBpbyA9PSBiaWxsaW5nX211bmljaXBhbGl0eV9uYW1lICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBvbmx5IG9uZSBjaXR5IGhpZGUgcG9zdGFsX2NvZGUsIGlmIG1vcmUgdGhhbiBvbmUgc2hvdyBkcm9wZG93biBsaXN0XHJcbiAgICAgICAgICAgICAgICBpZiggY3VycmVudF9tdW5pY2lwYWxpdHkuY2l1ZGFkZXMubGVuZ3RoID09IDEgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0X2h0bWwgPSBgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJpbnB1dC10ZXh0IFwiIG5hbWU9XCJiaWxsaW5nX3Bvc3Rjb2RlXCIgaWQ9XCJiaWxsaW5nX3Bvc3Rjb2RlXCIgcGxhY2Vob2xkZXI9XCJcIiB2YWx1ZT1cIiR7Y3VycmVudF9tdW5pY2lwYWxpdHkuY2l1ZGFkZXNbMF0uY29kaWdvX3Bvc3RhbF9jaXVkYWR9XCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCIgcmVhZG9ubHkgPmA7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI2JpbGxpbmdfcG9zdGNvZGVfZmllbGQgLndvb2NvbW1lcmNlLWlucHV0LXdyYXBwZXInKS5odG1sKHNlbGVjdF9odG1sKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjYmlsbGluZ19wb3N0Y29kZV9maWVsZCcpLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiggY3VycmVudF9tdW5pY2lwYWxpdHkuY2l1ZGFkZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdF9odG1sID0gYDxzZWxlY3QgaWQ9XCJiaWxsaW5nX3Bvc3Rjb2RlXCIgbmFtZT1cImJpbGxpbmdfcG9zdGNvZGVcIiBjbGFzcz1cImlucHV0LXRleHRcIiBzdHlsZT1cImRpc3BsYXk6IGJsb2NrO1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+YCArIGRsX3djX2d1YXRlbWFsYV9jaGVja291dF9qc192YXJzLmkxOG5fc2VsZWN0X3Bvc3Rjb2RlX3RleHQgKyBgPC9vcHRpb24+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+YDtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjYmlsbGluZ19wb3N0Y29kZV9maWVsZCAud29vY29tbWVyY2UtaW5wdXQtd3JhcHBlcicpLmh0bWwoc2VsZWN0X2h0bWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNiaWxsaW5nX3Bvc3Rjb2RlX2ZpZWxkJykuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgICAgICQoJyNiaWxsaW5nX3Bvc3Rjb2RlX2ZpZWxkIGxhYmVsJykuaHRtbCggZGxfd2NfZ3VhdGVtYWxhX2NoZWNrb3V0X2pzX3ZhcnMuaTE4bl9zZWxlY3RfcG9zdGNvZGVfbGFiZWwgKyAnIDxhYmJyIGNsYXNzPVwicmVxdWlyZWRcIiB0aXRsZT1cIm9ibGlnYXRvcmlvXCI+KjwvYWJicj4nKTtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50X211bmljaXBhbGl0eS5jaXVkYWRlcy5mb3JFYWNoKGZ1bmN0aW9uKGNpdWRhZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI2JpbGxpbmdfcG9zdGNvZGVcIikuYXBwZW5kKFwiPG9wdGlvbiB2YWx1ZT0nXCIgKyBjaXVkYWQuY29kaWdvX3Bvc3RhbF9jaXVkYWQgKyBcIic+XCIgKyBjaXVkYWQubm9tYnJlX2NpdWRhZCArIFwiPC9vcHRpb24+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGRldGVjdCB3aGVuIHVzZXIgc2VsZWN0cyBjaXR5IGFuZCBnZXQgY2l0eSBwb3N0YWwgY29kaWdvX2RlcGFydGFtZW50b1xyXG4gICAgICAgICQoZG9jdW1lbnQpLm9uKFwiY2hhbmdlXCIsIFwiI3NoaXBwaW5nX2NpdHlcIiwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIHZhciBzaGlwcGluZ19tdW5pY2lwYWxpdHlfbmFtZSA9ICQoXCIjc2hpcHBpbmdfY2l0eVwiKS52YWwoKTtcclxuICAgICAgICAgICAgdmFyIHNoaXBwaW5nX3N0YXRlX2lzb19jb2RlID0gJChcIiNzaGlwcGluZ19zdGF0ZVwiKS52YWwoKTtcclxuICAgICAgICAgICAgaWYoICQoJy53b29jb21tZXJjZS1lZGl0LWFkZHJlc3MnKS5sZW5ndGggKSB7XHJcbiAgICAgICAgICAgICAgICBzaGlwcGluZ19tdW5pY2lwYWxpdHlfbmFtZSA9ICQoXCIjc2hpcHBpbmdfY2l0eSBvcHRpb246c2VsZWN0ZWRcIikuYXR0cihcImRhdGEtY29kZVwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiggc2hpcHBpbmdfbXVuaWNpcGFsaXR5X25hbWUgIT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudF9tdW5pY2lwYWxpdHkgPSBkbF93Y19ndWF0ZW1hbGFfY2hlY2tvdXRfanNfdmFycy5tdW5pY2lwYWxpdGllc19hcnJheS5maW5kKCAkbXVuaWNpcGFsaXR5ID0+ICRtdW5pY2lwYWxpdHkuY29kaWdvX2lzb19kZXBhcnRhbWVudG8gPT0gc2hpcHBpbmdfc3RhdGVfaXNvX2NvZGUgJiYgJG11bmljaXBhbGl0eS5ub21icmVfbXVuaWNpcGlvID09IHNoaXBwaW5nX211bmljaXBhbGl0eV9uYW1lICk7XHJcbiAgICAgICAgICAgICAgICBpZiggJCgnLndvb2NvbW1lcmNlLWVkaXQtYWRkcmVzcycpLmxlbmd0aCApIHtcclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50X211bmljaXBhbGl0eSA9IGRsX3djX2d1YXRlbWFsYV9jaGVja291dF9qc192YXJzLm11bmljaXBhbGl0aWVzX2FycmF5LmZpbmQoICRtdW5pY2lwYWxpdHkgPT4gJG11bmljaXBhbGl0eS5jb2RpZ29faXNvX2RlcGFydGFtZW50byA9PSBzaGlwcGluZ19zdGF0ZV9pc29fY29kZSAmJiAkbXVuaWNpcGFsaXR5LmNvZGlnb19wb3N0YWxfbXVuaWNpcGlvID09IHNoaXBwaW5nX211bmljaXBhbGl0eV9uYW1lICk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvLyBpZiBvbmx5IG9uZSBjaXR5IGhpZGUgcG9zdGFsX2NvZGUsIGlmIG1vcmUgdGhhbiBvbmUgc2hvdyBkcm9wZG93biBsaXN0XHJcbiAgICAgICAgICAgICAgICBpZiggY3VycmVudF9tdW5pY2lwYWxpdHkuY2l1ZGFkZXMubGVuZ3RoID09IDEgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0X2h0bWwgPSBgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgY2xhc3M9XCJpbnB1dC10ZXh0IFwiIG5hbWU9XCJzaGlwcGluZ19wb3N0Y29kZVwiIGlkPVwic2hpcHBpbmdfcG9zdGNvZGVcIiBwbGFjZWhvbGRlcj1cIlwiIHZhbHVlPVwiJHtjdXJyZW50X211bmljaXBhbGl0eS5jaXVkYWRlc1swXS5jb2RpZ29fcG9zdGFsX2NpdWRhZH1cIiBzdHlsZT1cImRpc3BsYXk6IG5vbmVcIiByZWFkb25seSA+YDtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjc2hpcHBpbmdfcG9zdGNvZGVfZmllbGQgLndvb2NvbW1lcmNlLWlucHV0LXdyYXBwZXInKS5odG1sKHNlbGVjdF9odG1sKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjc2hpcHBpbmdfcG9zdGNvZGVfZmllbGQnKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIGN1cnJlbnRfbXVuaWNpcGFsaXR5LmNpdWRhZGVzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RfaHRtbCA9IGA8c2VsZWN0IGlkPVwic2hpcHBpbmdfcG9zdGNvZGVcIiBuYW1lPVwic2hpcHBpbmdfcG9zdGNvZGVcIiBjbGFzcz1cImlucHV0LXRleHRcIiBzdHlsZT1cImRpc3BsYXk6IGJsb2NrO1wiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+YCArIGRsX3djX2d1YXRlbWFsYV9jaGVja291dF9qc192YXJzLmkxOG5fc2VsZWN0X3Bvc3Rjb2RlX3RleHQgKyBgPC9vcHRpb24+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9zZWxlY3Q+YDtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjc2hpcHBpbmdfcG9zdGNvZGVfZmllbGQgLndvb2NvbW1lcmNlLWlucHV0LXdyYXBwZXInKS5odG1sKHNlbGVjdF9odG1sKTtcclxuICAgICAgICAgICAgICAgICAgICAkKCcjc2hpcHBpbmdfcG9zdGNvZGVfZmllbGQnKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NoaXBwaW5nX3Bvc3Rjb2RlX2ZpZWxkIGxhYmVsJykuaHRtbChkbF93Y19ndWF0ZW1hbGFfY2hlY2tvdXRfanNfdmFycy5pMThuX3NlbGVjdF9wb3N0Y29kZV9sYWJlbCArICcgPGFiYnIgY2xhc3M9XCJyZXF1aXJlZFwiIHRpdGxlPVwib2JsaWdhdG9yaW9cIj4qPC9hYmJyPicpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbXVuaWNpcGFsaXR5LmNpdWRhZGVzLmZvckVhY2goZnVuY3Rpb24oY2l1ZGFkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjc2hpcHBpbmdfcG9zdGNvZGVcIikuYXBwZW5kKFwiPG9wdGlvbiB2YWx1ZT0nXCIgKyBjaXVkYWQuY29kaWdvX3Bvc3RhbF9jaXVkYWQgKyBcIic+XCIgKyBjaXVkYWQubm9tYnJlX2NpdWRhZCArIFwiPC9vcHRpb24+XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAvLyBlbiBww6FnaW5zIGRlIG1pIGN1ZW50YSwgYWN0dWFsaXV6YXIgc2VsZWN0IG9wdGlvbnMgZGUgbXVuaWNpcGlvc1xyXG4gICAgICAgIGlmKCAkKCcud29vY29tbWVyY2UtZWRpdC1hZGRyZXNzJykubGVuZ3RoICkge1xyXG4gICAgICAgICAgICAkKCcjYmlsbGluZ19zdGF0ZScpLm9uKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiaWxsaW5nX3N0YXRlX3Bvc3RhbF9jb2RlID0gJChcIiNiaWxsaW5nX3N0YXRlXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJpbGxpbmdfbXVuaWNpcGFsaXRpZXMgPSBkbF93Y19ndWF0ZW1hbGFfY2hlY2tvdXRfanNfdmFycy5tdW5pY2lwYWxpdGllc19hcnJheS5maWx0ZXIoICRtdW5pY2lwYWxpdHkgPT4gJG11bmljaXBhbGl0eS5jb2RpZ29faXNvX2RlcGFydGFtZW50byA9PSBiaWxsaW5nX3N0YXRlX3Bvc3RhbF9jb2RlICk7XHJcbiAgICAgICAgICAgICAgICAkKCcjYmlsbGluZ19jaXR5JykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RfaHRtbCA9IGA8c2VsZWN0IG5hbWU9XCJiaWxsaW5nX2NpdHlcIiBpZD1cImJpbGxpbmdfY2l0eVwiIGNsYXNzPVwiY2l0eV9zZWxlY3QgXCIgYXV0b2NvbXBsZXRlPVwiYWRkcmVzcy1sZXZlbDJcIiBwbGFjZWhvbGRlcj1cIlwiPlxyXG4gICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT1cIlwiPmAgKyBkbF93Y19ndWF0ZW1hbGFfY2hlY2tvdXRfanNfdmFycy5pMThuX3NlbGVjdF9jaXR5X3RleHQgKyBgPC9vcHRpb24+XHJcbiAgICAgICAgICAgICAgICA8L3NlbGVjdD5gO1xyXG4gICAgICAgICAgICAgICAgJCgnI2JpbGxpbmdfY2l0eV9maWVsZCcpLmFwcGVuZChzZWxlY3RfaHRtbCk7XHJcbiAgICAgICAgICAgICAgICBiaWxsaW5nX211bmljaXBhbGl0aWVzLmZvckVhY2goZnVuY3Rpb24obXVuaWNpcGFsaXR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJChcIiNiaWxsaW5nX2NpdHlcIikuYXBwZW5kKFwiPG9wdGlvbiBkYXRhLWNvZGU9J1wiICsgbXVuaWNpcGFsaXR5LmNvZGlnb19wb3N0YWxfbXVuaWNpcGlvICsgXCInIHZhbHVlPSdcIiArIG11bmljaXBhbGl0eS5ub21icmVfbXVuaWNpcGlvICsgXCInPlwiICsgbXVuaWNpcGFsaXR5Lm5vbWJyZV9tdW5pY2lwaW8gKyBcIjwvb3B0aW9uPlwiKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAkKCcjc2hpcHBpbmdfc3RhdGUnKS5vbignY2hhbmdlJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2hpcHBpbmdfc3RhdGVfcG9zdGFsX2NvZGUgPSAkKFwiI3NoaXBwaW5nX3N0YXRlXCIpLnZhbCgpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNoaXBwaW5nX211bmljaXBhbGl0aWVzID0gZGxfd2NfZ3VhdGVtYWxhX2NoZWNrb3V0X2pzX3ZhcnMubXVuaWNpcGFsaXRpZXNfYXJyYXkuZmlsdGVyKCAkbXVuaWNpcGFsaXR5ID0+ICRtdW5pY2lwYWxpdHkuY29kaWdvX2lzb19kZXBhcnRhbWVudG8gPT0gc2hpcHBpbmdfc3RhdGVfcG9zdGFsX2NvZGUgKTtcclxuICAgICAgICAgICAgICAgICQoJyNzaGlwcGluZ19jaXR5JykucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3RfaHRtbCA9IGA8c2VsZWN0IG5hbWU9XCJzaGlwcGluZ19jaXR5XCIgaWQ9XCJzaGlwcGluZ19jaXR5XCIgY2xhc3M9XCJjaXR5X3NlbGVjdCBcIiBhdXRvY29tcGxldGU9XCJhZGRyZXNzLWxldmVsMlwiIHBsYWNlaG9sZGVyPVwiXCI+XHJcbiAgICAgICAgICAgICAgICA8b3B0aW9uIHZhbHVlPVwiXCI+YCArIGRsX3djX2d1YXRlbWFsYV9jaGVja291dF9qc192YXJzLmkxOG5fc2VsZWN0X2NpdHlfdGV4dCArIGA8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgIDwvc2VsZWN0PmA7XHJcbiAgICAgICAgICAgICAgICAkKCcjc2hpcHBpbmdfY2l0eV9maWVsZCcpLmFwcGVuZChzZWxlY3RfaHRtbCk7XHJcbiAgICAgICAgICAgICAgICBzaGlwcGluZ19tdW5pY2lwYWxpdGllcy5mb3JFYWNoKGZ1bmN0aW9uKG11bmljaXBhbGl0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICQoXCIjc2hpcHBpbmdfY2l0eVwiKS5hcHBlbmQoXCI8b3B0aW9uIGRhdGEtY29kZT0nXCIgKyBtdW5pY2lwYWxpdHkuY29kaWdvX3Bvc3RhbF9tdW5pY2lwaW8gKyBcIicgdmFsdWU9J1wiICsgbXVuaWNpcGFsaXR5Lm5vbWJyZV9tdW5pY2lwaW8gKyBcIic+XCIgKyBtdW5pY2lwYWxpdHkubm9tYnJlX211bmljaXBpbyArIFwiPC9vcHRpb24+XCIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG59KTtcclxuXHJcblxyXG4vLyBhZnRlciBldmVyeXRoaW5nIGxvYWRzXHJcblxyXG5qUXVlcnkod2luZG93KS5sb2FkKGZ1bmN0aW9uKCl7XHJcbiAgICBpZiggalF1ZXJ5KCcjYmlsbGluZ19jaXR5JykubGVuZ3RoICkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICBpZiggb25seU51bWJlcnMoIGpRdWVyeSgnI2JpbGxpbmdfY2l0eSBvcHRpb246bnRoLW9mLXR5cGUoMikgJykudmFsKCkgKSApIHtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjYmlsbGluZ19jaXR5JykuZmluZCgnb3B0aW9uJykuZWFjaCggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykuYXR0cihcImRhdGEtY29kZVwiLCBqUXVlcnkodGhpcykudmFsKCkgKTtcclxuICAgICAgICAgICAgICAgIGpRdWVyeSh0aGlzKS52YWwoIGpRdWVyeSh0aGlzKS50ZXh0KCkgKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAodHlwZW9mIGRsX3djX2d1YXRlbWFsYV9iaWxsaW5nX2NpdHkgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgIGpRdWVyeSgnI2JpbGxpbmdfY2l0eScpLmZpbmQoJ29wdGlvbicpLmVhY2goIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYoIGpRdWVyeSh0aGlzKS50ZXh0KCkgPT0gZGxfd2NfZ3VhdGVtYWxhX2JpbGxpbmdfY2l0eSApIHtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykuYXR0cignc2VsZWN0ZWQnLCAnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJyNiaWxsaW5nX2NpdHknKS50cmlnZ2VyKCdjaGFuZ2UnKTtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJyNiaWxsaW5nX3Bvc3Rjb2RlIG9wdGlvblt2YWx1ZT1cIicgKyBkbF93Y19ndWF0ZW1hbGFfYmlsbGluZ19wb3N0Y29kZSArICdcIl0nKS5hdHRyKCdzZWxlY3RlZCcsICdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnI2JpbGxpbmdfcG9zdGNvZGUgb3B0aW9uW3ZhbHVlPVwiJyArIGRsX3djX2d1YXRlbWFsYV9iaWxsaW5nX3Bvc3Rjb2RlICsgJ1wiXScpLnByb3AoJ3NlbGVjdGVkJywgdHJ1ZSk7ICAgXHJcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCcjYmlsbGluZ19wb3N0Y29kZScpLnRyaWdnZXIoJ2NoYW5nZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKCBqUXVlcnkoJyNzZWxlY3QyLWJpbGxpbmdfY2l0eS1jb250YWluZXInKS5sZW5ndGggPiAwICkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJyNzZWxlY3QyLWJpbGxpbmdfY2l0eS1jb250YWluZXInKS5odG1sKCBkbF93Y19ndWF0ZW1hbGFfYmlsbGluZ19jaXR5ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgXHJcblxyXG4gICAgaWYoIGpRdWVyeSgnI3NoaXBwaW5nX2NpdHknKS5sZW5ndGggKSB7XHJcblxyXG4gICAgICAgIGlmKCBvbmx5TnVtYmVycyggalF1ZXJ5KCcjc2hpcHBpbmdfY2l0eSBvcHRpb246bnRoLW9mLXR5cGUoMikgJykudmFsKCkgKSApIHtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjc2hpcHBpbmdfY2l0eScpLmZpbmQoJ29wdGlvbicpLmVhY2goIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgalF1ZXJ5KHRoaXMpLmF0dHIoXCJkYXRhLWNvZGVcIiwgalF1ZXJ5KHRoaXMpLnZhbCgpICk7XHJcbiAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykudmFsKCBqUXVlcnkodGhpcykudGV4dCgpICk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiBkbF93Y19ndWF0ZW1hbGFfc2hpcHBpbmdfY2l0eSAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgalF1ZXJ5KCcjc2hpcHBpbmdfY2l0eScpLmZpbmQoJ29wdGlvbicpLmVhY2goIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgaWYoIGpRdWVyeSh0aGlzKS52YWwoKSA9PSBkbF93Y19ndWF0ZW1hbGFfc2hpcHBpbmdfY2l0eSApIHtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykuYXR0cignc2VsZWN0ZWQnLCAnc2VsZWN0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkodGhpcykucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJyNzaGlwcGluZ19jaXR5JykudHJpZ2dlcignY2hhbmdlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCcjc2hpcHBpbmdfcG9zdGNvZGUgb3B0aW9uW3ZhbHVlPVwiJyArIGRsX3djX2d1YXRlbWFsYV9zaGlwcGluZ19wb3N0Y29kZSArICdcIl0nKS5hdHRyKCdzZWxlY3RlZCcsICdzZWxlY3RlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeSgnI3NoaXBwaW5nX3Bvc3Rjb2RlIG9wdGlvblt2YWx1ZT1cIicgKyBkbF93Y19ndWF0ZW1hbGFfc2hpcHBpbmdfcG9zdGNvZGUgKyAnXCJdJykucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKTsgICBcclxuICAgICAgICAgICAgICAgICAgICBqUXVlcnkoJyNzaGlwcGluZ19wb3N0Y29kZScpLnRyaWdnZXIoJ2NoYW5nZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKCBqUXVlcnkoJyNzZWxlY3QyLXNoaXBwaW5nX2NpdHktY29udGFpbmVyJykubGVuZ3RoID4gMCApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgalF1ZXJ5KCcjc2VsZWN0Mi1zaGlwcGluZ19jaXR5LWNvbnRhaW5lcicpLmh0bWwoIGRsX3djX2d1YXRlbWFsYV9zaGlwcGluZ19jaXR5ICk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gb25seU51bWJlcnMoc3RyKSB7XHJcbiAgICAgICAgcmV0dXJuIC9eXFxkKyQvLnRlc3Qoc3RyKTtcclxuICAgIH1cclxufSk7Il19